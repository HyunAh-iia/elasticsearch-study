# Contents

## 1. 검색 시스템의 이해

### 검색 시스템
검색서비스 > 검색시스템 > 검색엔진

- 검색서비스 : 검색엔진을 기반으로 구축한 검색 시스템을 활용해 검색 결과를 서비스로 제공
- 검색시스템 : 신뢰성 있는 검색 결과를 제공하기 위해 검색엔진을 기반으로 구축된 시스템
- 검색엔진 : 웹에서 정보를 수집해 검색 결과를 제공하는 프로그램

엘라스틱은 검색 엔진이며, 엘라스틱을 이용해 검색 시스템 구축이 가능하다.

### 검색 시스템의 구성요소
- 수집기 : 정보 수집
- 스토리지 : 수집한 데이터 저장
- 색인기(★) : 수집한 데이터를 검색에 적절한 형태로 변환 
    + 이 작업에는 형태소 분석기와 사전 작업 등을 통해 의미있는 용어를 추출하고, 검색에 유리한 역색인 구조로 데이터를 변환하는 것을 포함함
    + 우리는 영어가 아니라 "한글"을 쓴다. ==> inverted_index_and_analyser.md
- 검색기 : 색인된 데이터에서 일치하는 문서를 찾음

### 관계형 데이터베이스와의 차이점
+ 엘라스틱서치는 검색엔진이고, RDB는 데이터베이스이다.
+ 엘라스틱서치는 검색에 특화된 만큼, 비정형 데이터 색인 및 검색, 동의어나 유의어 처리를 통한 검색 등이 가능하며 심지어 빠른 속도로 검색이 가능함.
+ 엘라스틱 서치의 용어와 RDB의 용어 
  - 엘라스틱서치 vs 관계형데이터베이스
  - index vs database
  - shard vs partition
  - type vs table
  - document vs row
  - field vs column
  - mapping - schema
  - GET vs select
  - PUT vs inert
  - POST vs update, select
  - DELETE vs delete
  - HEAD vs - (인덱스 정보 확인)
+ 역색인되는 문자열 전체를 "정책"에 따라 소문자 혹은 대문자로 생성하고 쿼리가 들어오는 필터를 색인 시간과 검색 시간에 동일하게 지정한다면 해당하는 쿼리에 어떠한 문자열 (text, Text, TEXT)이 들어와도 검색이 가능해진다.
+ (참고) ES 6.0 이후부터는 하나의 인덱스에 하나의 타입만 구성 가능함


## 2. 검색 시스템과 엘라스틱 서치
  
  1. 엘라스틱서치가 강력한 이유
  - 오픈소스 검색엔진 : 아파티 재단의 루씬(Lucence)을 기반으로한 오픈소스 검색엔진. 활성화된 커뮤니티.
  - 전문 검색(Full Text) : 내용 전체를 색인해서 특전 단어가 포함된 문서를 검색
  - 통계 분석 : 비정형 로그를 수집해 한곳에 모아 통계 분석 가능. 키바나(kibana)를 연결하면 실시간으로 쌓이는 로그를 시각화하고 분석 가능
  - 스키마리스 : 정형화되지 않은 다양한 형태의 문서도 자동으로 색인하고 검색할 수 있다.
  - RESTful API : HTTP 기반의 RESTful API를 지원하기 때문에 개발 언어, 운영 체제, 시스템에 관계없이 이기종 플랫폼에서도 이용 가능
  - 멀티테넌시(Multi-tenancy) : 서로 상이한 인덱스일지라도 검색할 필드명만 같으면 여러 개의 인덱스를 한번에 조회할 수 있음. 이를 이용해 멀티테넌시 기능을 제공할 수 있다.
  - Document-Oriented : 여러 계층의 데이터를 JSON 형식의 구조화된 문서로 인덱스에 저장 가능. 계층 구조로 문서도 한번의 쿼리로 쉽게 조회 가능함
  - 역색인(Inverted Index) : 일반적인 NoSQL은 역색인을 지원하지 않는데, 엘라스틱서치는 지원함 
  - 확장성과 가용성 : 분산 환경에서 데이터는 샤드(shard)라는 작은 단위로 나뉘어 제공되며, 인덱스를 만들 때 마다 샤드의 수를 조절 가능
  
  2. 엘라스틱서치의 약점
  - 준 실시간(Near Realtime) : 실시간이 아니다. 색인된 데이터는 통상적으로 1초 뒤에나 검색이 가능하다. 색인된 데이터는 commit과 flush가은 과정을 거치기 떄문
  - 롤백(Rollback)과 트랜잭션(Transcation) : 전체적인 클러스터의 성능 향상을 위해 시스템적으로 비용이 큰 롤백과 트랜잭션을 지원하지 않는다. 최악의 경우 데이터 손실의 위험이 있다.
  - 데이터의 업데이트 미제공 : update가 아니라 delete 후 insert이다. 이런 이유로 단순 update에 비해 비교적 많은 비용이 발생한다. 하지만 이것이 큰 단점은 아니다. 이로 인해 불변적(Immutable)이라는 이점을 취할 수 있다.
  
## 3. 실습 환경 구축
  - 윈도우 환경에서 설치


# 나의 생각
+ 엘라스틱서치는 full text 제공을 위해 doc의 단어 하나 하나의 키워드(term) 미리 저장해둔다. 그렇다면 이 term이 정확해야 엘라스틱 검색 결과도 정확해진다. 
+ 왜 검색엔진과 RDB를 비교할까?
  - 공통점은 데이터 저장과 검색이 가능하다는 점
  - 검색엔진보다는 RDB에 친숙한 사람이 많으니, RDB를 기준으로 어떤 점이 다른 지 알아보는 것도 ES를 이해하는 데 도움이 됨
  - 하지만 용도가 다르다는 점은 명심!
+ 엘라스틱서치와 RDB의 용도는 어떻게 다를까?
  - 엘라스틱은 검색엔진이고, RDB는 데이터베이스이다.
  - 엘라스틱서치는 준 실시간이기 때문에 비즈니스에 따라 해당 부분은 민감하게 반응될 수 있다.
  - 엘라스틱은 "검색"에 특화 되어있고, RDB는 "트랜잭션"에 특화되어있다.
  - 보통 고객에게 제공되는 검색 데이터는 엘라스틱을 통해 제공되지만, 고객의 요청으로 데이터 변경이 일어나는 기능은 RDB 트랜잭션을 이용한다. 고객의 요청은 한 건, 한 건 소중하니까ㅎㅎ
+ 엘라스틱서치와 RDB의 설계
  - 엘라스틱이 빠른 이유 중 하나는 검색이 편리한 구조로 데이터를 역색인(inverted index)한다는 점이다.
  - doc(row) 데이터의 text 하나 하나(term)에 index(rdb의 index)가 걸려있고, 그 단어(term)가 pk로 검색될 수 있게 역색인된 구조라고 생각하면 된다. (진짜 그렇다는 건 아니다.)
  - 그래서 색인기에 대한 이해와 한글에 대한 이해도 높아야함.
  - 그리고 RDB는 정규화가 중요한데(ES에서도 중요하겠지만), 엘라스틱은 잘 뭉쳐서 담는 게 중요한 것 같다.
+ 엘라스틱의 스키마리스(schemaless) 정말 장점일까?
  - 내가 만약 ES를 운영하게 된다면, 신규 기능으로 인해 추가된 컬럼들을 테이블 변경 없이 생성이 가능해지는 거니까 유용하긴 할 것 같다.
  - 스키마리스하더라도 어느 정도의 정규화된 데이터 구조를 가지고 있는 게 운영 측면에서 좋을 것 같다.
  - 스키마리스 기능은 off 시켜두는 것이 안정적일 것 같다. 신규 기능 추가로 인해 정말 필요한 컬럼이 아니라면 자동 추가되면 곤란할 것 같다. 그런 데이터가 발생한다는 건 서비스 기능이나 운영에 이슈가 있다는 뜻일 수도 있다.